
import React, { useState, useEffect, useRef } from 'react';
import { PROJECTS } from './constants';
import { MenuCategory, Project } from './types';
import Sidebar from './components/Sidebar';

const App: React.FC = () => {
  const [currentCategory, setCurrentCategory] = useState<MenuCategory>('WORK');
  const [activeProjectId, setActiveProjectId] = useState<string | null>(PROJECTS[0].id);
  const [activeProject, setActiveProject] = useState<Project | null>(PROJECTS[0]);
  const scrollContainerRef = useRef<HTMLDivElement>(null);

  const designLabImages = [
    'https://raw.githubusercontent.com/StudioPinVice/StudioPinVice/main/1-5Hannam5.jpg',
    'https://raw.githubusercontent.com/StudioPinVice/StudioPinVice/main/1-5Hannam00.jpg',
    'https://raw.githubusercontent.com/StudioPinVice/StudioPinVice/main/1-5Hannam1.jpg',
    'https://raw.githubusercontent.com/StudioPinVice/StudioPinVice/main/1-5Hannam2.jpg',
    'https://raw.githubusercontent.com/StudioPinVice/StudioPinVice/main/1-5Hannam3.jpg',
    'https://raw.githubusercontent.com/StudioPinVice/StudioPinVice/main/1-5Hannam4.jpg',
    'https://raw.githubusercontent.com/StudioPinVice/StudioPinVice/main/1-5Hannam6.jpg',
    'https://raw.githubusercontent.com/StudioPinVice/StudioPinVice/main/1-5Hannam7.jpg',
    'https://raw.githubusercontent.com/StudioPinVice/StudioPinVice/main/1-5Hannam8.jpg',
    'https://raw.githubusercontent.com/StudioPinVice/StudioPinVice/main/1-5Hannam9.jpg',
    'https://raw.githubusercontent.com/StudioPinVice/StudioPinVice/main/1-5Hannam10.jpg',
    'https://raw.githubusercontent.com/StudioPinVice/StudioPinVice/main/1-5Hannam11.jpg',
    'https://raw.githubusercontent.com/StudioPinVice/StudioPinVice/main/1-5Hannam12.jpg',
    'https://raw.githubusercontent.com/StudioPinVice/StudioPinVice/main/1-5Hannam13.jpg',
    'https://raw.githubusercontent.com/StudioPinVice/StudioPinVice/main/1-5Hannam14.jpg',
    'https://raw.githubusercontent.com/StudioPinVice/StudioPinVice/main/1-5Hannam15.jpg',
    'https://raw.githubusercontent.com/StudioPinVice/StudioPinVice/main/1-5Hannam16.jpg',
    'https://raw.githubusercontent.com/StudioPinVice/StudioPinVice/main/1-5Hannam17.jpg',
    'https://raw.githubusercontent.com/StudioPinVice/StudioPinVice/main/1-5Hannam18.jpg',
    'https://raw.githubusercontent.com/StudioPinVice/StudioPinVice/main/1-5Hannam19.jpg',
    'https://raw.githubusercontent.com/StudioPinVice/StudioPinVice/main/1-5Hannam20.jpg',
    'https://raw.githubusercontent.com/StudioPinVice/StudioPinVice/main/1-5Hannam21.jpg',
    'https://raw.githubusercontent.com/StudioPinVice/StudioPinVice/main/1-5Hannam22.jpg',
    'https://raw.githubusercontent.com/StudioPinVice/StudioPinVice/main/1-5Hannam23.jpg'
  ];

  useEffect(() => {
    if (activeProjectId) {
      const project = PROJECTS.find(p => p.id === activeProjectId);
      if (project) {
        setActiveProject(project);
        if (scrollContainerRef.current) {
          scrollContainerRef.current.scrollTop = 0;
        }
      }
    } else {
      setActiveProject(null);
    }
  }, [activeProjectId]);

  const handleLogoClick = () => {
    setCurrentCategory('WORK');
    setActiveProjectId(null);
  };

  const handleCategoryChange = (cat: MenuCategory) => {
    setCurrentCategory(cat);
    if (cat === 'WORK') {
      setActiveProjectId(PROJECTS[0].id);
    } else {
      setActiveProjectId(null);
    }
  };

  const getImages = () => {
    if (!activeProject) return [];
    if (activeProject.id === '1-5-design-lab') {
      return designLabImages;
    }
    return [activeProject.imageUrl];
  };

  const images = getImages();

  return (
    <div className="w-screen h-screen bg-white p-[10px] overflow-hidden">
      <div className="flex w-full h-full bg-white overflow-hidden">
        <main 
          ref={scrollContainerRef}
          className="flex-1 relative overflow-y-auto bg-white scroll-smooth no-scrollbar"
        >
          {activeProject ? (
            <div className="flex flex-col w-full">
              {images.map((url, idx) => (
                <div 
                  key={idx} 
                  className="w-full relative flex justify-center"
                >
                  <img 
                    src={url} 
                    alt={`${activeProject.title} ${idx}`}
                    className="w-full h-auto block"
                    loading="lazy"
                  />
                </div>
              ))}
            </div>
          ) : (
            <div className="w-full h-full flex items-center justify-center bg-white" />
          )}
        </main>

        <Sidebar 
          currentCategory={currentCategory}
          onCategoryChange={handleCategoryChange}
          projects={PROJECTS}
          activeProjectId={activeProjectId || ''}
          onProjectSelect={setActiveProjectId}
          onLogoClick={handleLogoClick}
        />
      </div>

      <style>{`
        .no-scrollbar::-webkit-scrollbar {
          display: none;
        }
        .no-scrollbar {
          -ms-overflow-style: none;
          scrollbar-width: none;
        }
      `}</style>
    </div>
  );
};

export default App;
